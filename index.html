<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meruňková Láska</title>
    <style>
        body {
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            flex-direction: column;
            touch-action: none; 
            user-select: none;
            overflow: hidden; 
        }

        canvas {
            border: 4px solid #ecf0f1;
            background-color: #87CEEB;
            image-rendering: pixelated;
            box-shadow: 0 0 30px rgba(0,0,0,0.6);
            width: 95vw;
            max-width: 1000px; 
            height: auto;
            max-height: 75vh; /* Trochu menší výška, aby zbyl plac na tlačítka */
            display: block;
        }

        #controls {
            display: flex;
            gap: 40px;
            margin-top: 15px;
            width: 100%;
            justify-content: center;
            padding-bottom: 20px;
        }

        .btn {
            width: 90px;
            height: 70px;
            background-color: #e67e22;
            border: 4px solid #d35400;
            border-radius: 20px;
            font-size: 35px;
            color: white;
            cursor: pointer;
            user-select: none; 
            -webkit-user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            background-color: #d35400;
            transform: translateY(4px);
        }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="controls">
    <button id="btnLeft" class="btn">⬅️</button>
    <button id="btnRight" class="btn">➡️</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');

    // --- NASTAVENÍ ---
    let score = 0;
    const winScore = 15;
    let gameOver = false;
    let isCutscene = false;
    let kissHappened = false;

    const groundHeight = 60; 
    const apricotSize = 26;

    // --- POSTAVY ---
    const adelka = {
        x: canvas.width / 2,
        y: canvas.height - groundHeight - 70, // Ještě vyšší
        width: 44,
        height: 70,
        color: '#e74c3c', 
        speed: 9, 
        dx: 0,
        facingLeft: false, // Sledujeme, kam se dívá
        basketWidth: 24
    };

    const mirecek = {
        x: -60,
        y: canvas.height - groundHeight - 72, 
        width: 44,
        height: 72,
        color: '#3498db',
        pantsColor: '#2c3e50',
        speed: 5,
        active: false,
        facingLeft: false
    };

    let apricots = [];
    let spawnRate = 45; 
    let frameCount = 0;

    // --- OVLÁDÁNÍ ---
    document.addEventListener('keydown', (e) => {
        if (isCutscene || gameOver) return;
        if (e.key === 'ArrowRight' || e.key === 'd') {
            adelka.dx = adelka.speed;
            adelka.facingLeft = false;
        }
        if (e.key === 'ArrowLeft' || e.key === 'a') {
            adelka.dx = -adelka.speed;
            adelka.facingLeft = true;
        }
    });

    document.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowRight' || e.key === 'd') adelka.dx = 0;
        if (e.key === 'ArrowLeft' || e.key === 'a') adelka.dx = 0;
    });

    function startMove(direction) {
        if (isCutscene || gameOver) return;
        adelka.dx = direction * adelka.speed;
        adelka.facingLeft = direction < 0;
    }
    function stopMove() {
        adelka.dx = 0;
    }

    btnLeft.addEventListener('mousedown', () => startMove(-1));
    btnLeft.addEventListener('touchstart', (e) => { e.preventDefault(); startMove(-1); });
    btnLeft.addEventListener('mouseup', stopMove);
    btnLeft.addEventListener('touchend', stopMove);
    
    btnRight.addEventListener('mousedown', () => startMove(1));
    btnRight.addEventListener('touchstart', (e) => { e.preventDefault(); startMove(1); });
    btnRight.addEventListener('mouseup', stopMove);
    btnRight.addEventListener('touchend', stopMove);

    // --- KRESLENÍ STROMU (VYLEPŠENÉ) ---
    function drawTree(x, height) {
        const trunkW = 40;
        const trunkH = height;
        const trunkX = x + 30;
        const trunkY = canvas.height - groundHeight - trunkH;

        // Kmen
        ctx.fillStyle = '#8B4513';
        ctx.fillRect(trunkX, trunkY, trunkW, trunkH);
        
        // Větev (detail)
        ctx.fillRect(trunkX - 20, trunkY + 50, 20, 10);

        // KORUNA STROMU (Skládaná z více tvarů pro hezčí vzhled)
        const crownBaseY = trunkY - 20;
        
        // Tmavší zelená (spodek)
        ctx.fillStyle = '#228B22'; 
        ctx.fillRect(x, crownBaseY, 100, 60);
        ctx.fillRect(x - 20, crownBaseY - 20, 140, 60);

        // Světlejší zelená (vršek - dává tomu objem)
        ctx.fillStyle = '#32CD32'; 
        ctx.fillRect(x + 10, crownBaseY - 40, 80, 60);
        ctx.fillRect(x - 10, crownBaseY - 10, 120, 30);
        
        // Pár "listů" (detail)
        ctx.fillStyle = '#7CFC00';
        ctx.fillRect(x + 20, crownBaseY - 30, 10, 10);
        ctx.fillRect(x + 70, crownBaseY, 10, 10);
    }

    // --- KRESLENÍ POSTAV (DETAILNÍ OBLIČEJ) ---
    function drawCharacter(char, isMale) {
        const x = Math.round(char.x);
        const y = Math.round(char.y);
        const w = char.width;
        
        // Určení směru pohledu pro oči
        let lookOffset = 0;
        if (char.facingLeft) lookOffset = -4;
        else lookOffset = 4;
        
        // Pokud stojí, dívá se tam, kam šel naposledy (nebo dopředu)
        if (char.dx === 0 && !isMale) {
             // U Adélky necháme oči uprostřed, když stojí, nebo podle posledního směru
             // Pro jednoduchost necháme offset podle facingLeft
        }

        // --- 1. ZADNÍ VLASY ---
        if (!isMale) {
            ctx.fillStyle = '#5D4037'; // Tmavší hnědá
            // Dlouhé vlasy vzadu
            ctx.fillRect(x - 2, y + 10, w + 4, char.height - 10); 
        }

        // --- 2. TĚLO (Oblečení) ---
        const headSize = 28; // Velká hlava
        const bodyY = y + headSize;
        const bodyH = char.height - headSize;

        ctx.fillStyle = char.color;
        ctx.fillRect(x + 4, bodyY, w - 8, 20); // Horní část těla

        // Nohy / Spodek
        if (isMale) {
            ctx.fillStyle = char.pantsColor;
            ctx.fillRect(x + 4, bodyY + 20, w - 8, bodyH - 20); 
            // Mezera mezi nohama
            ctx.fillStyle = '#87CEEB'; // Pozadí
            ctx.fillRect(x + w/2 - 2, bodyY + 25, 4, bodyH - 25);
        } else {
            // Sukně
            ctx.fillRect(x + 2, bodyY + 20, w - 4, bodyH - 20); 
        }

        // --- 3. HLAVA A OBLIČEJ (To nejdůležitější!) ---
        
        // Pleť (Obličej)
        ctx.fillStyle = '#FFE0BD'; // Světlá pleťová
        ctx.fillRect(x + 4, y, w - 8, headSize);

        // Oči (Bělmo + Panenka)
        // Levé oko
        ctx.fillStyle = 'white';
        ctx.fillRect(x + 8, y + 10, 10, 10);
        ctx.fillStyle = 'black';
        ctx.fillRect(x + 10 + lookOffset, y + 12, 4, 4); // Panenka se hýbe

        // Pravé oko
        ctx.fillStyle = 'white';
        ctx.fillRect(x + w - 18, y + 10, 10, 10);
        ctx.fillStyle = 'black';
        ctx.fillRect(x + w - 16 + lookOffset, y + 12, 4, 4); // Panenka se hýbe

        // Pusa
        ctx.fillStyle = '#D35400';
        ctx.fillRect(x + w/2 - 4, y + 22, 8, 2);

        // Tvářenky (roztomilost)
        ctx.fillStyle = '#FFB6C1';
        ctx.fillRect(x + 6, y + 18, 4, 2);
        ctx.fillRect(x + w - 10, y + 18, 4, 2);

        // --- 4. PŘEDNÍ VLASY (Ofina) ---
        if (isMale) {
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(x + 4, y, w - 8, 6); // Krátká ofina
            ctx.fillRect(x + 2, y, 4, 12); // Kotlety
        } else {
            ctx.fillStyle = '#5D4037';
            ctx.fillRect(x + 2, y, w - 4, 8); // Ofina
            // Prameny po stranách tváře
            ctx.fillRect(x, y, 6, headSize); 
            ctx.fillRect(x + w - 6, y, 6, headSize);
        }

        // --- 5. KOŠÍK ---
        if (!isMale) {
            ctx.fillStyle = '#D2691E';
            // Košík drží v ruce (pozice se mění podle směru)
            const basketX = char.facingLeft ? x - 10 : x + w - 14;
            
            ctx.fillRect(basketX, bodyY + 12, char.basketWidth, 16); 
            ctx.fillRect(basketX, bodyY + 8, char.basketWidth, 4); // Ucho
        }
    }

    function drawApricot(x, y) {
        ctx.fillStyle = '#FFA500'; 
        ctx.fillRect(x, y + 4, apricotSize, apricotSize - 4);
        // Odlesk
        ctx.fillStyle = '#FFD700';
        ctx.fillRect(x + 6, y + 8, 6, 6); 
        // Stopka s lístkem
        ctx.fillStyle = '#228B22'; 
        ctx.fillRect(x + 10, y, 4, 4); 
        ctx.fillRect(x + 12, y + 2, 6, 3); 
    }

    function drawBackground() {
        // Obloha (vymazání)
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Tráva
        ctx.fillStyle = '#2ecc71';
        ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);
        // Detail trávy (proužek)
        ctx.fillStyle = '#27ae60';
        ctx.fillRect(0, canvas.height - groundHeight, canvas.width, 10);
        
        // Vykreslení hezčích stromů
        drawTree(50, 250);   // Levý strom
        drawTree(650, 220);  // Pravý strom
    }

    function drawHeart(x, y) {
        ctx.fillStyle = '#e74c3c';
        const size = 3; 
        ctx.fillRect(x + 2*size, y, 2*size, 2*size);
        ctx.fillRect(x + 6*size, y, 2*size, 2*size);
        ctx.fillRect(x, y + 2*size, 10*size, 2*size);
        ctx.fillRect(x + 2*size, y + 4*size, 6*size, 2*size);
        ctx.fillRect(x + 4*size, y + 6*size, 2*size, 2*size);
    }

    // --- UPDATE ---
    function update() {
        if (gameOver && kissHappened) return;

        if (!isCutscene) {
            adelka.x += adelka.dx;
            if (adelka.x < 0) adelka.x = 0;
            if (adelka.x + adelka.width > canvas.width) adelka.x = canvas.width - adelka.width;

            if (score < winScore) {
                frameCount++;
                if (frameCount % spawnRate === 0) {
                    apricots.push({
                        x: Math.random() * (canvas.width - apricotSize),
                        y: -apricotSize,
                        speed: Math.random() * 3 + 3 
                    });
                }
            } else {
                isCutscene = true;
                apricots = []; 
                mirecek.active = true;
                adelka.dx = 0; 
                // Otočíme Adélku k Mirečkovi (přichází zleva, tak se dívá doleva)
                adelka.facingLeft = true; 
            }

            for (let i = apricots.length - 1; i >= 0; i--) {
                apricots[i].y += apricots[i].speed;
                
                // Detekce kolize (Košík je teď širší zóna kolem hráče)
                const basketRect = {
                    x: adelka.x - 20,
                    y: adelka.y + 20,
                    width: adelka.width + 40,
                    height: 50
                };

                if (
                    apricots[i].x < basketRect.x + basketRect.width &&
                    apricots[i].x + apricotSize > basketRect.x &&
                    apricots[i].y < basketRect.y + basketRect.height &&
                    apricots[i].y + apricotSize > basketRect.y
                ) {
                    score++;
                    apricots.splice(i, 1);
                } else if (apricots[i].y > canvas.height) {
                    apricots.splice(i, 1);
                }
            }
        } else if (isCutscene && !kissHappened) {
            // Mireček jde k Adélce
            const targetX = adelka.x - 50; 
            if (mirecek.x < targetX) {
                mirecek.x += mirecek.speed;
                mirecek.facingLeft = false; // Jde doprava
            } else {
                kissHappened = true;
                setTimeout(() => { gameOver = true; }, 3000);
            }
        }
    }

    function draw() {
        drawBackground();
        drawCharacter(adelka, false);

        if (mirecek.active) drawCharacter(mirecek, true);
        for (const apricot of apricots) drawApricot(apricot.x, apricot.y);

        ctx.fillStyle = 'white';
        ctx.font = 'bold 30px "Courier New"';
        // Stín pod textem, aby byl čitelný na stromech
        ctx.fillStyle = 'black';
        if (!isCutscene && !gameOver) {
            ctx.fillText('Košík: ' + score + ' / ' + winScore, 22, 52);
            ctx.fillStyle = 'white';
            ctx.fillText('Košík: ' + score + ' / ' + winScore, 20, 50);
        }

        if (kissHappened) drawHeart(adelka.x - 25, adelka.y - 40);

        if (gameOver) {
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#FF69B4';
            ctx.font = 'bold 40px "Courier New"';
            ctx.textAlign = 'center';
            ctx.fillText('LÁSKA ZVÍTĚZILA!', canvas.width / 2, canvas.height / 2);
            
            ctx.fillStyle = 'white';
            ctx.font = '24px "Courier New"';
            ctx.fillText('Adélka s Mirečkem mají 15 meruněk', canvas.width / 2, canvas.height / 2 + 60);
        }
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
</body>
</html>
